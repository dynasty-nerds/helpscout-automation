<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate Response Template</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            resize: vertical;
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        .checkbox-group input {
            margin-right: 10px;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .response-container {
            margin-top: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
        }
        .response-text {
            white-space: pre-wrap;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
        }
        .metadata {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }
        .metadata-item {
            margin-bottom: 10px;
            color: #666;
        }
        .metadata-item strong {
            color: #333;
        }
        .tags {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 5px;
        }
        .tag {
            background: #e0e0e0;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        .error {
            background: #fee;
            color: #c00;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
        }
        .loading {
            text-align: center;
            color: #666;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽ¯ Generate Customer Response Template</h1>
        
        <div class="form-group">
            <label for="issueDescription">Issue Description</label>
            <textarea 
                id="issueDescription" 
                rows="5" 
                placeholder="Describe the issue customers are experiencing. Be specific about the problem and any relevant context."
            >Users who signed up through the App Store are not seeing their subscription reflected in the app. They have active App Store subscriptions but the app shows them as free users.</textarea>
        </div>

        <div class="form-group">
            <label for="customerName">Customer Name (optional)</label>
            <input 
                type="text" 
                id="customerName" 
                placeholder="Enter customer name or leave blank for generic"
            />
        </div>

        <div class="form-group">
            <label for="tone">Response Tone</label>
            <select id="tone">
                <option value="friendly">Friendly</option>
                <option value="professional">Professional</option>
                <option value="empathetic">Empathetic</option>
            </select>
        </div>

        <div class="checkbox-group">
            <input type="checkbox" id="includeApology" checked>
            <label for="includeApology">Include apology for inconvenience</label>
        </div>

        <button onclick="generateResponse()">Generate Response</button>

        <div id="result"></div>
    </div>

    <script>
        function copyToClipboard() {
            const textarea = document.getElementById('responseText');
            textarea.select();
            document.execCommand('copy');
            
            // Show feedback
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'âœ… Copied!';
            setTimeout(() => {
                button.textContent = originalText;
            }, 2000);
        }
        
        async function generateResponse() {
            const button = document.querySelector('button');
            const resultDiv = document.getElementById('result');
            
            // Get form values
            const issueDescription = document.getElementById('issueDescription').value;
            const customerName = document.getElementById('customerName').value || 'there';
            const tone = document.getElementById('tone').value;
            const includeApology = document.getElementById('includeApology').checked;
            
            if (!issueDescription) {
                alert('Please enter an issue description');
                return;
            }
            
            // Disable button and show loading
            button.disabled = true;
            button.textContent = 'Generating...';
            resultDiv.innerHTML = '<div class="loading">ðŸ¤– Generating response...</div>';
            
            try {
                const response = await fetch('/api/generate-response', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        issueDescription,
                        customerName,
                        tone,
                        includeApology
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Use a textarea for better copy-paste compatibility with HelpScout
                    resultDiv.innerHTML = `
                        <div class="response-container">
                            <h3>Generated Response:</h3>
                            <textarea 
                                id="responseText"
                                class="response-text" 
                                style="width: 100%; min-height: 300px; border: none; background: transparent; resize: vertical;"
                                readonly>${data.response}</textarea>
                            <button onclick="copyToClipboard()" style="margin-top: 10px;">ðŸ“‹ Copy to Clipboard</button>
                            <div class="metadata">
                                <div class="metadata-item">
                                    <strong>Cost:</strong> $${data.metadata.cost.toFixed(4)}
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <strong>Error:</strong> ${data.error}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            } finally {
                button.disabled = false;
                button.textContent = 'Generate Response';
            }
        }
    </script>
</body>
</html>